<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/pure-min.css" 
    integrity="sha384-nn4HPE8lTHyVtfCBi5yW9d20FjT8BJwUXyWZT9InLYax14RDjBj46LmSztkmNP9w" 
    crossorigin="anonymous">
<style>
	.mycanvas{
		float:left;
		background:url(map.png);
	}
    .button-xsmall {
      font-size: 70%;
    }

    .button-small {
      font-size: 85%;
    }

    .button-large {
        font-size: 110%;
    }

    .button-xlarge {
      background: rgb(28, 184, 65);
    }

    img{
    top:0;
    left:0;
    position:absolute;
}
 </style>
</head> 
<body>

<canvas width=800 height=542 id="mycanvas" class='mycanvas' ></canvas>

<button class="button-xlarge pure-button" onClick="spawnBackpackTower()";>Backpack tower $10</button>



<script>

var canvas = document.getElementById("mycanvas");
canvas.addEventListener("click", placeBackpackTower, false);


var ctx = mycanvas.getContext("2d");
var x=5, y=0;

var stuSpnX=700, stuSpnY=250;
var money=40;
window.onload = animate;

var posX=0, posY=0;


var foodImg = new Image();
var mapImg = new Image();
var backpackImg = new Image();

foodImg.src = "student.png";
mapImg.src = "map.png";
backpackImg.src = "backpackTower.png";
var stuX=100, stuY=100;

var towers = [];
var enemies = [];

function Follow(){
    var x = event.clientX;      //x and y relative to the 
    var y = event.clientY;      //window's coordinate system
    
}

setInterval(animate, 33);

function animate() {
  
  if(!placingTower) {
    clearBackground();
    drawStuff();
    placeEnemy();

    //put ai methods calls here
  }
  
  //alert("animating");
}



function clearBackground() {
  ctx.drawImage(mapImg, 0,0,800,542);
}

var currEnemyCount=0;
var enemyCount=33;


function drawStuff() {
  ctx.fillStyle = "black";
  ctx.font = "30px Arial";
 
  for(var pos in towers) {
    towers[pos].draw();
    
  }
  for(var pos in enemies) {
    enemies[pos].draw();
    if(isCollide(enemies[pos], towers[pos])){
      console.log(enemies[pos].health)
      enemies[pos].health-=towers[pos].damage;
    }
    if(enemies[pos].startY==50){
      moveTop(enemies[pos]);
    }
    else if(enemies[pos].startY==250){
      moveMiddle(enemies[pos]);
    }
    else {
      moveBottom(enemies[pos]);
    }   
  }
}


//////////////////TOWER FUNCTIONS//////////////////////
var placingTower=false;


function tower(x, y, damage, img, weaponImg){
  this.x=x;
  this.y=y;
  this.image=img
  this.draw = function() {
    ctx.drawImage(img, this.x, this.y);
  }
}   

function placeBackpackTower(event) {
    if(placingTower) {
        var xPox = event.clientX;
        var yPox = event.clientY;
        towers.push(new tower(xPox, yPox, 10, backpackImg));
        money-=10;
        placingTower = false;
    }
}

function spawnBackpackTower(){
  if(money>=10){  
    placingTower=true;
  }  
}

//////////////////TOWER FUNCTIONS//////////////////////

function isCollide(tower, food) {
    return (
        ((tower.y + tower.height) < (food.y)) ||
        (tower.y > (food.y + food.height)) ||
        ((tower.x + tower.width) < food.x) ||
        (tower.x > (food.x + food.width))
    );
}


//////////////////ENEMY FUNCTIONS//////////////////////

function food(x, y, sY, hp, img){
  this.x=x;
  this.y=y;
  this.startY=sY;
  this.health=hp;
  this.foodImg=img
  this.draw = function() {
    ctx.drawImage(foodImg, this.x, this.y);
  }
}  

function placeEnemy() {

    if(currEnemyCount<=enemyCount) {
        var walkWay = Math.random();
        var x;
        var y;
        var startX;
        var startY;


        if(walkWay<=.33){//Top
            x=750;
            y=70;
            startX=750;
            startY=50;
            
        }
        else if(walkWay<=.66 && walkWay>.33){//Middle
            x=750;
            y=235;
            startX=750;
            startY=250;
        } 
        else if(walkWay>.66){//Bottom
            x=750;
            y=470;
            startX=750;
            startY=500;
    }
        enemies.push(new food(x, y, startY, 20));
        currEnemyCount++;
    }
}



function moveTop(enemy){
  if (enemy.x>=463){
    enemy.x--;
    enemy.y+=.1;
  }
  else if(enemy.x<=463&&enemy.x>=430){
    enemy.y+=1;
    enemy.x-=.2; 
  }  
  else if(enemy.x<=430&&enemy.x>=445){
    enemy.x-=.4;
    enemy.y-=1;
  }
  else if(enemy.x<=445)
  	enemy.x--;
}


function moveMiddle(enemy){
  if(enemy.x>=560){
    enemy.x--;
  }
  else if(enemy.x<=560 && enemy.y<=419)
    enemy.y++;
}


function moveBottom(enemy){

}

//////////////////ENEMY FUNCTIONS//////////////////////


</script>
</body>
</html>


